<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TP.02-Cristian</title>
</head>

<body>

    <div id="app">
        <h1>Cristian Ruppel</h1>
        <p><strong>Nombre:</strong> {{ nombre }}</p>
        <p><strong>Edad:</strong> {{ edad }}</p>
        <p><strong>Ciudad:</strong> {{ ciudad }}</p>
        <hr>
        <p>Hola, mi nombre es {{ nombre }}, tengo {{ edad }} años y soy de {{ ciudad }}.</p>
        <hr>
        <h2>Contador Interactivo</h2>
        <p>Contador: {{ contador }}</p>
        <button @click="incrementar">Incrementar</button>
        <button @click="decrementar">Decrementar</button>
        <hr>
        
        <h2>Paso 1 - Lista de Eventos del Ciclo de Vida</h2>
        <ul>
            <li v-for="evento in listaEventos" :key="evento.id">
                <strong>{{ evento.id }}. {{ evento.nombre }}</strong> - {{ evento.timestamp }}
            </li>
        </ul>
        <hr>

        <h2>Lista de Tareas</h2>

        <input v-model="nuevaTarea" placeholder="Agregar nueva tarea">
        <button @click="agregarTarea">Agregar Tarea</button>

        <ul>
            <li v-for="tarea in tareas" :key="tarea.id">
                <input type="checkbox" v-model="tarea.completada">
                <span>{{ tarea.texto }}</span>
            </li>
        </ul>

        <p><strong>Total de Tareas:</strong> {{ totalTareas }}</p>
        <p><strong>Tareas Pendientes:</strong> {{ tareasPendientes }}</p>
    </div>

    <script src="https://unpkg.com/vue@3"></script>

    <script>
        const { createApp, ref, computed, onBeforeMount, onMounted, onBeforeUnmount, onUnmounted } = Vue;
        // Importo onBeforeUpdate y onUpdated pero los dejamos sin implementar para evitar el loop.

        let idEvento = 1;

        createApp({
            setup() {
                // PASO 1: Lista de Eventos del Ciclo de Vida  
                const listaEventos = ref([]);

                const registrarEvento = (nombre) => {
                    const ahora = new Date();
                    const timestamp = ahora.toLocaleString('es-AR', {
                        year: 'numeric',
                        month: '2-digit',
                        day: '2-digit',
                        hour: '2-digit',
                        minute: '2-digit',
                        second: '2-digit',
                        hour12: false
                    }) + '.' + ahora.getMilliseconds();

                    listaEventos.value.push({
                        id: idEvento++,
                        nombre: nombre,
                        timestamp: timestamp
                    });
                };

                registrarEvento('created'); 
                
                onBeforeMount(() => {
                    registrarEvento('beforeMount'); 
                });

                onMounted(() => {
                    registrarEvento('mounted'); 
                });

                // IMPORTANTE: omito onBeforeUpdate (beforeUpdate) y onUpdated (updated)
                // ya que al modificar la variable reactiva 'listaEventos' dentro de estos hooks,
                // se provoca un bucle infinito de actualización que bloquea la aplicación.
                // onBeforeUpdate(() => { registrarEvento('beforeUpdate'); }); // ⬅Esto causa el loop
                // onUpdated(() => { registrarEvento('updated'); });         // ⬅ Esto causa el loop
                // Para demostrar su existencia, se muestro este comentario.

                onBeforeUnmount(() => {
                    registrarEvento('beforeDestroy');
                });

                onUnmounted(() => {
                    registrarEvento('destroyed');
                });
                
                const nombre = ref("Cristian Ruppel");
                const edad = ref(43);
                const ciudad = ref("Carmen de Patagones");
                const contador = ref(0);

                function incrementar() {
                    contador.value++;
                }

                function decrementar() {
                    if (contador.value > 0) {
                        contador.value--;
                    }
                }

                const nuevaTarea = ref('');

                const tareas = ref([
                    { id: 1, texto: 'Aprender vue.js', completada: false },
                    { id: 2, texto: 'Hacer el TP 01', completada: true },
                ]);

                let siguienteId = 3;

                function agregarTarea() {
                    if (nuevaTarea.value.trim() !== '') {
                        tareas.value.push({
                            id: siguienteId++,
                            texto: nuevaTarea.value,
                            completada: false
                        });
                        nuevaTarea.value = '';
                    }
                }

                const totalTareas = computed(() => {
                    return tareas.value.length;
                });

                const tareasPendientes = computed(() => {
                    return tareas.value.filter(tarea => !tarea.completada).length;
                });

                return {
                    listaEventos,
                    nombre,
                    edad,
                    ciudad,
                    contador,
                    incrementar,
                    decrementar,
                    nuevaTarea,
                    tareas,
                    agregarTarea,
                    totalTareas,
                    tareasPendientes
                };
            }
        }).mount('#app');
    </script>

</body>
</html>