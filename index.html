<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TP.02-Cristian</title>
    <style>
        /* Estilos para el Paso 3 */
        .post-list {
            flex: 1; 
            margin-right: 20px;
        }
        .comments-section {
            flex: 1;
            border-left: 1px solid #ddd;
            padding-left: 20px;
        }
        .post-item {
            cursor: pointer;
            padding: 10px;
            margin-bottom: 5px;
            border: 1px solid #eee;
            border-radius: 4px;
            transition: background-color 0.2s;
        }
        .post-item:hover {
            background-color: #f9f9f9;
        }
        .post-item.selected {
            font-weight: bold;
            background-color: #e0f7fa; 
            border-color: #00bcd4;
        }
    </style>
</head>

<body>

    <div id="app">
        <h1>Cristian Ruppel</h1>
        <p><strong>Nombre:</strong> {{ nombre }}</p>
        <p><strong>Edad:</strong> {{ edad }}</p>
        <p><strong>Ciudad:</strong> {{ ciudad }}</p>
        <hr>
        <p>Hola, mi nombre es {{ nombre }}, tengo {{ edad }} años y soy de {{ ciudad }}.</p>
        <hr>
        <h2>Contador Interactivo</h2>
        <p>Contador: {{ contador }}</p>
        <button @click="incrementar">Incrementar</button>
        <button @click="decrementar">Decrementar</button>
        <hr>
        
        <h2>Paso 1 - Lista de Eventos del Ciclo de Vida</h2>
        <ul>
            <li v-for="evento in listaEventos" :key="evento.id">
                <strong>{{ evento.id }}. {{ evento.nombre }}</strong> - {{ evento.timestamp }}
            </li>
        </ul>
        <hr>

        <h2>Lista de Tareas</h2>

        <input v-model="nuevaTarea" placeholder="Agregar nueva tarea">
        <button @click="agregarTarea">Agregar Tarea</button>

        <ul>
            <li v-for="tarea in tareas" :key="tarea.id">
                <input type="checkbox" v-model="tarea.completada">
                <span>{{ tarea.texto }}</span>
            </li>
        </ul>

        <p><strong>Total de Tareas:</strong> {{ totalTareas }}</p>
        <p><strong>Tareas Pendientes:</strong> {{ tareasPendientes }}</p>
        <hr>
        
        <h2>Paso 3 - Lista de Posts y Comentarios</h2>
        
        <div style="display: flex;">
            <div class="post-list">
                <h3>Posts (Click para ver comentarios)</h3>
                <div v-if="listaPosts.length === 0">Cargando posts...</div>
                <ul style="list-style-type: none; padding: 0;">
                    <li v-for="post in listaPosts" :key="post.id" 
                        @click="cargarComentarios(post.id)"
                        :class="['post-item', { 'selected': post.id === postSeleccionadoId }]">
                        <strong>Post #{{ post.id }}</strong>: {{ post.title }}
                        <p style="font-size: 0.9em; margin: 5px 0 0;">{{ post.body.substring(0, 50) }}...</p>
                    </li>
                </ul>
            </div>

            <div class="comments-section">
                <h3>Comentarios del Post #{{ postSeleccionadoId || '...' }}</h3>
                <div v-if="postSeleccionadoId === null">
                    <p>Selecciona un Post para ver sus comentarios.</p>
                </div>
                <div v-else-if="comentariosPost === null">
                    <p>Cargando comentarios...</p>
                </div>
                <div v-else-if="comentariosPost.length === 0">
                    <p>Este Post no tiene comentarios.</p>
                </div>
                <ul v-else style="padding-left: 20px;">
                    <li v-for="comment in comentariosPost" :key="comment.id" style="margin-bottom: 10px;">
                        <strong>{{ comment.email }}</strong>: {{ comment.body }}
                    </li>
                </ul>
            </div>
        </div>

    </div>

    <script src="https://unpkg.com/vue@3"></script>
    <script src="https://unpkg.com/axios/dist/axios.min.js"></script> 

    <script>
        const { createApp, ref, computed, onBeforeMount, onMounted, onBeforeUnmount, onUnmounted } = Vue;

        let idEvento = 1;

        createApp({
            setup() {
                // PASO 1: Lista de Eventos del Ciclo de Vida 
                
                const listaEventos = ref([]);

                const registrarEvento = (nombre) => {
                    const ahora = new Date();
                    const timestamp = ahora.toLocaleString('es-AR', {
                        year: 'numeric',
                        month: '2-digit',
                        day: '2-digit',
                        hour: '2-digit',
                        minute: '2-digit',
                        second: '2-digit',
                        hour12: false
                    }) + '.' + ahora.getMilliseconds();

                    listaEventos.value.push({
                        id: idEvento++,
                        nombre: nombre,
                        timestamp: timestamp
                    });
                };

                registrarEvento('created'); 
                
                onBeforeMount(() => {
                    registrarEvento('beforeMount'); 
                });
                
                // PASO 3: Ejecuto la carga de posts en onMounted
                onMounted(async () => {
                    registrarEvento('mounted'); 
                    
                    // PASO 3: Uso un bucle for que obtiene los 10 primeros posts 
                    for (let i = 1; i <= 10; i++) {
                        const post = await obtenerPost(i);
                        if (post) {
                            listaPosts.value.push(post);
                        }
                    }
                });

                // Hooks de Actualización (Omitidos para evitar el loop)
                // onBeforeUpdate() y onUpdated() no se implementan aca.

                onBeforeUnmount(() => {
                    registrarEvento('beforeDestroy');
                });

                onUnmounted(() => {
                    registrarEvento('destroyed');
                });
                
                const nombre = ref("Cristian Ruppel");
                const edad = ref(43);
                const ciudad = ref("Carmen de Patagones");
                const contador = ref(0);

                function incrementar() {
                    contador.value++;
                }

                function decrementar() {
                    if (contador.value > 0) {
                        contador.value--;
                    }
                }

                const nuevaTarea = ref('');

                const tareas = ref([
                    { id: 1, texto: 'Aprender vue.js', completada: false },
                    { id: 2, texto: 'Hacer el TP 01', completada: true },
                ]);

                let siguienteId = 3;

                function agregarTarea() {
                    if (nuevaTarea.value.trim() !== '') {
                        tareas.value.push({
                            id: siguienteId++,
                            texto: nuevaTarea.value,
                            completada: false
                        });
                        nuevaTarea.value = '';
                    }
                }

                const totalTareas = computed(() => {
                    return tareas.value.length;
                });

                const tareasPendientes = computed(() => {
                    return tareas.value.filter(tarea => !tarea.completada).length;
                });
                
                // PASO 2: Implementación de Axios
                
                const obtenerPost = async (postId) => {
                    try {
                        const url = `https://jsonplaceholder.typicode.com/posts/${postId}`; 
                        const response = await axios.get(url);
                        return response.data; 
                    } catch (error) {
                        console.error("Tuve un error al obtener el post:", error);
                        return null;
                    }
                };

                const obtenerComments = async (postId) => {
                    try {
                        const url = `https://jsonplaceholder.typicode.com/posts/${postId}/comments`; 
                        const response = await axios.get(url);
                        return response.data;
                    } catch (error) {
                        console.error("Tuve un error al obtener los comentarios:", error);
                        return [];
                    }
                };
                
                // PASO 3: Variables Reactivas y Cargar Comentarios
                
                // Creo las listas vacías para posts y comentarios 
                const listaPosts = ref([]); 
                const comentariosPost = ref([]); 
                const postSeleccionadoId = ref(null);

                const cargarComentarios = async (postId) => {
                    postSeleccionadoId.value = postId; 
                    comentariosPost.value = null;
                    
                    comentariosPost.value = await obtenerComments(postId); 
                };

                return {
                    listaEventos,
                    nombre,
                    edad,
                    ciudad,
                    contador,
                    incrementar,
                    decrementar,
                    nuevaTarea,
                    tareas,
                    agregarTarea,
                    totalTareas,
                    tareasPendientes,
                    // Variables y funciones del Paso 3
                    listaPosts,
                    comentariosPost,
                    postSeleccionadoId,
                    cargarComentarios
                };
            }
        }).mount('#app');
    </script>

</body>
</html>